<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Book List</title>
</head>
<body>

<h2>Books</h2>

<!-- Back to Dashboard Button -->
<p><a th:href="@{/dashboard}"><button>Back to Dashboard</button></a></p>

<!-- Search & Sort Form -->
<form method="get" th:action="@{/books}">
    <label for="search">Search:</label>
    <input type="text" id="search" name="search" th:value="${search}" placeholder="Title, Author, Publisher, Category" />

    <label for="sortBy">Sort By:</label>
    <select id="sortBy" name="sortBy">
        <option th:selected="${sortBy == null}">-- None --</option>
        <option value="title" th:selected="${sortBy == 'title'}">Title</option>
        <option value="price" th:selected="${sortBy == 'price'}">Price</option>
    </select>

    <button type="submit">Apply</button>
</form>

<!-- Add New Book Link (Admins Only) -->
<div th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
    <p><a th:href="@{/books/new}">Add New Book</a></p>
</div>

<!-- Book Table -->
<table border="1">
    <tr>
        <th>Title</th>
        <th>Author</th>
        <th>Price</th>
        <th>Category</th>
        <th>Publisher</th>
        <th>ISBN</th>
        <th th:if="${#authorization.expression('hasRole(''CUSTOMER'')')}">Add to Cart</th>
    </tr>

    <tr th:each="book : ${books}">
        <!-- Title as clickable link -->
        <td>
            <a th:href="@{'/books/' + ${book.id}}" th:text="${book.title}"></a>
        </td>
        <td th:text="${book.author}"></td>
        <td th:text="${#numbers.formatDecimal(book.price, 1, 2)}"></td>
        <td th:text="${book.category}"></td>
        <td th:text="${book.publisher}"></td>
        <td th:text="${book.isbn}"></td>

        <!-- Add to Cart form (Customers only) -->
        <td th:if="${#authorization.expression('hasRole(''CUSTOMER'')')}">
            <form th:action="@{'/cart/add/' + ${book.id}}" method="post">
                <input type="number" name="quantity" value="1" min="1" style="width: 50px;" />
                <button type="submit">Add</button>
            </form>
        </td>
    </tr>
</table>

</body>
</html>
